<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>éŠæˆ²èªªæ˜ - é€²æ“Šçš„èŸ‘è‚æˆ°é¬¥éŠæˆ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="style.css" />
  <script>window.ASSETS_ROOT = "/";</script>
  <!-- å…¨åŸŸéŸ³è¨Šè§£é–å·¥å…·ï¼ˆç„¡ importï¼‰ -->
  <script src="js/core/audio-unlocker.js"></script>

  <style>
    /* ===== ç¥ç§˜é»‘åº•ï¼šåªå½±éŸ¿æœ¬é  ===== */
    body { margin:0; color:#fff; background:#000; position:relative; overflow-x:hidden; }
    body::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background:
        radial-gradient(80% 60% at 50% 35%, rgba(255,255,255,0.06) 0%, rgba(0,0,0,0) 60%),
        radial-gradient(120% 80% at 50% 120%, rgba(0,0,0,0.85) 10%, rgba(0,0,0,1) 70%);
      background-blend-mode: screen, normal;
    }
    a.skip-link{
      position:fixed; left:16px; top:12px; transform:translateY(-150%);
      background:#000; color:#fff; padding:.5rem .75rem; border-radius:10px; border:2px solid #ffd166;
      box-shadow:0 4px 18px rgba(0,0,0,.45); z-index:10000; transition:transform .18s ease, box-shadow .18s ease;
    }
    a.skip-link:focus, a.skip-link:focus-visible{ transform:translateY(0); outline:none; box-shadow:0 6px 24px rgba(0,0,0,.6); }

    main{
      max-width:1000px; margin:3rem auto; padding:1.25rem;
      background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.15); border-radius:16px;
      backdrop-filter:blur(4px); box-shadow:0 10px 40px rgba(0,0,0,0.5);
      opacity:0; animation:fadeInMain .7s ease-out forwards;
    }
    @keyframes fadeInMain { to { opacity:1; } }

    .equip{ margin-top:1.25rem; }
    .equip h2{ margin:0 0 .4rem; position:relative; text-shadow:0 2px 10px rgba(0,0,0,.7); }
    .equip h2::after{
      content:""; display:block; width:140px; height:3px; margin-top:.45rem;
      background:linear-gradient(90deg, #ffd166, rgba(255,209,102,0)); border-radius:2px;
    }

    .equip-grid{ display:flex; justify-content:center; flex-wrap:wrap; gap:2rem; margin-top:1rem; }
    .item{
      flex:1 1 240px; max-width:280px; text-align:left;
      background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.18);
      border-radius:14px; padding:1rem; backdrop-filter:blur(4px);
      box-shadow:0 3px 10px rgba(0,0,0,0.35); transition:transform .2s ease;
    }
    .item:hover{ transform:translateY(-3px); }
    .item figure{ margin:0; }
    .item img{
      max-width:240px; width:100%; height:auto; border-radius:10px; margin:0 auto .8rem; display:block;
      background:rgba(255,255,255,0.08); padding:.35rem;
    }
    .item figcaption{ font-weight:700; margin-bottom:.25rem; }

    .sr-actions{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin:.25rem 0 1rem; }
    .sr-btn{
      appearance:none; border:1px solid rgba(255,255,255,.28);
      background:rgba(255,255,255,.12); color:#fff; border-radius:10px; padding:.5rem .8rem; cursor:pointer;
    }
    .sr-btn:focus-visible{ outline:2px solid #ffd166; outline-offset:2px; }

    ul{ line-height:1.8; margin:.4rem 0 0; }
    #startBtn{
      margin-top:2rem; font-size:1.2rem; padding:.7rem 1.6rem; border-radius:999px; font-weight:700; cursor:pointer;
    }

    /* è¡Œå‹•ç«¯ï¼šæŒ‰éˆ•æ›´å¤§ã€é‚Šè·æ›´å¯¬ */
    @media (pointer:coarse){
      .sr-btn{ padding:.7rem 1rem; font-size:1.05rem; border-radius:12px; }
      #startBtn{ font-size:1.25rem; padding:.85rem 1.8rem; }
    }

    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body class="guide">
  <a href="#main" class="skip-link">è·³åˆ°ä¸»å…§å®¹</a>

  <main id="main">
    <h1>éŠæˆ²èªªæ˜</h1>

    <section class="equip" aria-labelledby="equipTitle">
      <h2 id="equipTitle">å‹‡è€…çš„åˆå§‹è£å‚™</h2>
      <div class="sr-actions">
        <button class="sr-btn" id="readEquip" aria-keyshortcuts="1">æœ—è®€æœ¬ç¯€ï¼ˆå¿«æ·éµ 1ï¼‰</button>
        <span id="srStatus" class="sr-only" aria-live="polite"></span>
      </div>

      <div class="equip-grid">
        <div class="item">
          <figure>
            <img src="assets/images/weapons/firegun.png" alt="ä¸€æŠŠå™´ç«æ§æ­£åœ¨ç«çƒ¤èŸ‘è‚çš„ç•«é¢ã€‚">
            <figcaption tabindex="0"><span class="sr-only">å™´ç«æ§</span></figcaption>
          </figure>
          <p>ğŸ”¥ å™´ç«æ§ï¼šèµ·å§‹å€¼æœ‰ 10 æ¬¡ï¼Œè®“èŸ‘è‚å€‘è®Šæˆçƒ¤å°å¼·ã€‚</p>
        </div>
        <div class="item">
          <figure>
            <img src="assets/images/weapons/spray.png" alt="ä¸€ç½é¦™æ°›å™´éœ§æ­£åœ¨å™´èŸ‘è‚ï¼ŒèŸ‘è‚å€‘å€’åœ°æŠ½æçš„ç•«é¢ã€‚">
            <figcaption tabindex="0"><span class="sr-only">é¦™æ°›å™´éœ§</span></figcaption>
          </figure>
          <p>ğŸŒ¸ é¦™æ°›å™´éœ§ï¼šèµ·å§‹å€¼æœ‰ 10 æ¬¡ï¼Œäººé¡è¦ºå¾—é¦™ï¼ŒèŸ‘è‚èäº†è¶…æƒ³åã€‚</p>
        </div>
        <div class="item">
          <figure>
            <img src="assets/images/weapons/slipper.png" alt="è—ç™½æ‹–æ‰“ä¸­èŸ‘è‚å™´æ±çš„ç•«é¢ã€‚">
            <figcaption tabindex="0"><span class="sr-only">è—ç™½æ‹–</span></figcaption>
          </figure>
          <p>ğŸ©´ è—ç™½æ‹–ï¼šè¿‘è·é›¢å¿…æ®ºï¼Œå‘½ä¸­ç¬é–“çˆ†æ“Šå™´æ±ï¼Œèµ·å§‹å€¼å¯ä½¿ç”¨ 10 æ¬¡ã€‚</p>
        </div>
      </div>
    </section>

    <section aria-labelledby="controlTitle">
      <h2 id="controlTitle">æ“ä½œæ–¹å¼</h2>
      <div class="sr-actions">
        <button class="sr-btn" id="readControl" aria-keyshortcuts="2">æœ—è®€æœ¬ç¯€ï¼ˆå¿«æ·éµ 2ï¼‰</button>
      </div>
      <ul id="controlList">
        <!-- å…§å®¹æœƒç”±è…³æœ¬ä¾è£ç½®å‹æ…‹ï¼ˆæ¡Œæ©Ÿ/æ‰‹æ©Ÿï¼‰ç½®æ› -->
        <li>è¼‰å…¥ä¸­â€¦</li>
      </ul>
    </section>

    <section aria-labelledby="tipsTitle">
      <h2 id="tipsTitle">é‡è¦æç¤º</h2>
      <div class="sr-actions">
        <button class="sr-btn" id="readTips" aria-keyshortcuts="3">æœ—è®€æœ¬ç¯€ï¼ˆå¿«æ·éµ 3ï¼‰</button>
      </div>
      <ul id="tipsList">
        <li>éŠæˆ²å…±äº”é—œï¼Œé›£åº¦æœƒæ„ˆä¾†æ„ˆé«˜ï¼Œå‡ºç¾çš„èŸ‘è‚ç¨®é¡ä¹Ÿæœƒå¢åŠ ï¼Œæ„ˆé›£å°ä»˜ã€‚</li>
        <li>ä¸åŒèŸ‘è‚æ€•çš„æ­¦å™¨ä¸åŒï¼Œè«‹ç•™æ„æ¯é—œé–‹é ­çš„èªªæ˜ï¼Œè¦è°æ˜é¸æ“‡ï¼</li>
        <li>æ”»æ“Šå¤±èª¤æœƒè¢«èŸ‘è‚åæ“Šï¼Œå°å¿ƒæ‰£è¡€æˆ–æå¤±é‡‘å¹£ã€‚</li>
        <li>è‹¥åœ¨æœ‰ç‰¹æ®Šéšœç¤™ç‰©çš„æƒ…å¢ƒï¼Œä¹Ÿè«‹å°å¿ƒæ‰£è¡€æˆ–æå¤±é‡‘å¹£ã€‚</li>
        <li>è¡€é‡æ­¸é›¶æˆ–è¢«èŸ‘è‚ç‹ å’¬ 5 æ¬¡ï¼ŒéŠæˆ²å°±æœƒçµæŸã€‚</li>
      </ul>
    </section>

    <section aria-labelledby="nvdaTitle">
      <h2 id="nvdaTitle">NVDA ä½¿ç”¨å»ºè­°</h2>
      <div class="sr-actions">
        <button class="sr-btn" id="readNVDA" aria-keyshortcuts="4">æœ—è®€æœ¬ç¯€ï¼ˆå¿«æ·éµ 4ï¼‰</button>
      </div>
      <ul id="nvdaTips">
        <li>é€²å…¥é—œå¡å¾Œï¼Œè«‹æŒ‰ <kbd>NVDA</kbd> + <kbd>ç©ºç™½éµ</kbd> åˆ‡æ›åˆ°ã€Œç„¦é»æ¨¡å¼ã€ï¼Œå†ç”¨æ–¹å‘éµæ“ä½œã€‚</li>
        <li>è‹¥è¦ºå¾—å ±è®€å¤ªåµï¼Œå¯æŒ‰ <kbd>NVDA</kbd> + <kbd>S</kbd> åœ¨ã€Œæœ—è®€ï¼æç¤ºéŸ³ï¼éœéŸ³ã€é–“åˆ‡æ›ã€‚</li>
        <li>éŠæˆ²å…§å»ºçš„ TTS æœƒå ±è®€èŸ‘è‚åº§æ¨™èˆ‡é—œéµäº‹ä»¶ï¼›NVDA å ±è®€åªæ˜¯è¼”åŠ©ï¼Œå¹²æ“¾æ™‚å¯æš«æ™‚é—œé–‰ã€‚</li>
      </ul>
    </section>

    <button id="startBtn" aria-describedby="startDesc">éŠæˆ²é–‹å§‹å‰å…ˆä¾†èªè­˜æ•µäºº</button>
    <span id="startDesc" class="sr-only">æŒ‰ä¸‹å°‡å‰å¾€èŸ‘è‚åœ–é‘‘èˆ‡æ•™å­¸é ã€‚</span>
  </main>

  <!-- èƒŒæ™¯éŸ³æ¨‚ï¼ˆèªªæ˜é å°ˆç”¨ï¼‰ -->
  <audio id="bgm" src="assets/sounds/tutorial_theme.mp3" loop preload="auto" playsinline></audio>

  <!-- âœ… å–®ä¸€å…¥å£ï¼šç”¨ ES Module å¯«æœ¬é è¡Œç‚º -->
  <script type="module">
    // ====== BGM è§£é– & æ·¡å…¥ ======
    const bgm = document.getElementById('bgm');
    try {
      // ç›¸å®¹ä¸åŒå‘½åçš„è§£é–å™¨
      if (window.AudioFX?.init) window.AudioFX.init();
      if (window.AudioFX?.register) window.AudioFX.register(bgm);
      if (window.AudioUnlocker?.prime) window.AudioUnlocker.prime();
    } catch {}

    function fadeInAudio(audio, target = 0.6, durMs = 900) {
      audio.volume = 0; const steps = 18, delta = target/steps, stepMs = Math.ceil(durMs/steps);
      let i = 0; const timer = setInterval(()=>{ i++; audio.volume = Math.min(target, audio.volume + delta); if(i>=steps) clearInterval(timer); }, stepMs);
    }
    let audioArmed = false;
    function armBgm(){
      if (audioArmed) return; audioArmed = true;
      bgm?.play()?.then(()=>fadeInAudio(bgm, 0.6, 900)).catch(()=>{});
    }
    document.addEventListener('click', armBgm, { once:true });
    document.addEventListener('keydown', armBgm, { once:true });
    document.addEventListener('touchstart', armBgm, { once:true, passive:true });

    // ====== èªéŸ³åˆæˆï¼ˆç« ç¯€å¿«é€Ÿæœ—è®€ï¼‰ ======
    function speak(text){
      try{
        if(!('speechSynthesis' in window) || !text) return;
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang='zh-TW'; u.rate=1.5; u.pitch=1.0; u.volume=1.0;
        speechSynthesis.speak(u);
      }catch(_){}
    }
    function sectionText(el){
      if(!el) return "";
      let t = ""; const h2 = el.querySelector('h2'); if (h2) t += h2.textContent + "ã€‚";
      el.querySelectorAll('p, li').forEach(p => t += p.textContent + "ã€‚");
      return t;
    }
    function live(msg){ const sr = document.getElementById('srStatus'); if (sr) sr.textContent = msg || ""; }

    const secEquip = document.querySelector('.equip');
    const secCtrl  = document.querySelector('[aria-labelledby="controlTitle"]');
    const secTips  = document.querySelector('[aria-labelledby="tipsTitle"]');
    const secNVDA  = document.querySelector('[aria-labelledby="nvdaTitle"]');

    document.getElementById('readEquip')?.addEventListener('click', ()=>{ speak(sectionText(secEquip)); live('å·²æœ—è®€ï¼šåˆå§‹è£å‚™ã€‚'); });
    document.getElementById('readControl')?.addEventListener('click', ()=>{ speak(sectionText(secCtrl));  live('å·²æœ—è®€ï¼šæ“ä½œæ–¹å¼ã€‚'); });
    document.getElementById('readTips')?.addEventListener('click', ()=>{ speak(sectionText(secTips));    live('å·²æœ—è®€ï¼šé‡è¦æç¤ºã€‚'); });
    document.getElementById('readNVDA')?.addEventListener('click',  ()=>{ speak(sectionText(secNVDA));   live('å·²æœ—è®€ï¼šNVDA ä½¿ç”¨å»ºè­°ã€‚'); });

    document.addEventListener('keydown', (e)=>{
      if (e.altKey || e.ctrlKey || e.metaKey) return;
      if (e.key === '1') { e.preventDefault(); document.getElementById('readEquip')?.click(); }
      else if (e.key === '2') { e.preventDefault(); document.getElementById('readControl')?.click(); }
      else if (e.key === '3') { e.preventDefault(); document.getElementById('readTips')?.click(); }
      else if (e.key === '4') { e.preventDefault(); document.getElementById('readNVDA')?.click(); }
    });

    // ====== æ“ä½œæ–¹å¼ï¼šä¾è£ç½®å‹æ…‹é¡¯ç¤ºï¼ˆæ¡Œæ©Ÿ vs æ‰‹æ©Ÿï¼‰ ======
    const controlList = document.getElementById('controlList');
    const isCoarse = window.matchMedia?.('(pointer: coarse)')?.matches ?? false;

    const desktopItems = [
      'ç§»å‹•è§’è‰²ä½ç½®ï¼šä½¿ç”¨ç®­é ­ â† ã€ â†’ ã€ â†‘ ã€ â†“',
      'æƒæç›®å‰å€åŸŸæ˜¯å¦æœ‰èŸ‘è‚ï¼šç©ºç™½éµ',
      'åˆ‡æ›æ­¦å™¨ï¼šæ•¸å­— 1 å™´ç«æ§ã€2 é¦™æ°›å™´éœ§ã€3 è—ç™½æ‹–ï¼ˆç¬¬ 4ï½5 é—œæœƒå†è§£é– 4ï½7ï¼‰',
      'ç™¼å‹•æ”»æ“Šï¼šEnter éµ',
      'èªéŸ³æœ—è®€ç©å®¶ç›®å‰ç‹€æ…‹ï¼šShift + S',
      'åˆ‡æ›ç•«é¢èˆ‡ç´”è½è¦ºæ“ä½œæ¨¡å¼ï¼šShift + M'
    ];

    const mobileItems = [
      'ç§»å‹•è§’è‰²ä½ç½®ï¼šåœ¨ç•«é¢ä¸Šã€Œæ»‘å‹•ã€ä¸Šä¸‹å·¦å³',
      'ç™¼å‹•æ”»æ“Šï¼šåœ¨ç•«é¢ä¸Šã€Œé›™æ“Šã€',
      'åˆ‡æ›æ­¦å™¨ï¼šæš«ä»¥æ•¸å­—éµï¼ˆ1/2/3â€¦ï¼‰ç‚ºä¸»ï¼›è¡Œå‹•æ‰‹å‹¢å°‡æ–¼å¾ŒçºŒåŠ å…¥',
      'èªéŸ³æœ—è®€ç©å®¶ç›®å‰ç‹€æ…‹ï¼šShift + Sï¼ˆå¤–æ¥éµç›¤ï¼‰',
      'åˆ‡æ›ç•«é¢èˆ‡ç´”è½è¦ºæ“ä½œæ¨¡å¼ï¼šShift + Mï¼ˆå¤–æ¥éµç›¤ï¼‰',
      'â€» å°æé†’ï¼šé–‹å•Ÿè¢å¹•é–±è®€å™¨æ™‚ï¼Œæ»‘å‹•æœƒè¢«ç³»çµ±æ””æˆªï¼Œè«‹æ”¹ç”¨åº•éƒ¨å¤§å‹æŒ‰éˆ•ï¼ˆé€²å…¥é—œå¡å¾Œæœƒå‡ºç¾ï¼‰ã€‚'
    ];

    function renderControls(items){
      controlList.innerHTML = '';
      items.forEach(t => { const li = document.createElement('li'); li.textContent = t; controlList.appendChild(li); });
    }
    renderControls(isCoarse ? mobileItems : desktopItems);

    // è¦–çª—å°ºå¯¸æˆ–æŒ‡æ¨™å‹æ…‹è®Šæ›´æ™‚ï¼Œé‡æ–°æ¸²æŸ“
    try {
      window.matchMedia('(pointer: coarse)').addEventListener?.('change', (e)=>renderControls(e.matches?mobileItems:desktopItems));
    } catch {}

    // ====== é–‹å§‹æŒ‰éˆ• ======
    document.getElementById('startBtn').addEventListener('click', () => {
      window.location.href = 'bugs_guide.html';
    });
  </script>
</body>
</html>
