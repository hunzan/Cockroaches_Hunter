<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>èŸ‘è‚åœ–é‘‘</title>
  <link rel="stylesheet" href="style.css" />
  <script>window.ASSETS_ROOT = "/";</script>
  <script src="js/core/audio-unlocker.js"></script>
  <style>
    body { margin: 0; padding: 0; background: #0b0b0b url("assets/images/start_bg.png") center/cover no-repeat fixed; color: #fff; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 1.2rem; }
    h1 { margin: .5rem 0 1rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
    .card { background: rgba(0,0,0,.45); border: 1px solid #ffffff33; border-radius: 12px; padding: 12px; }
    .card img { width: 100%; height: auto; border-radius: 10px; display: block; }
    .meta { font-size: .95rem; line-height: 1.6; }
    .tag { display: inline-block; margin-right: .4rem; margin-bottom: .2rem; padding: .1rem .5rem; border-radius: 999px; background: #ffffff22; font-size: .85rem; }
    .btnbar { margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap; }
    .btn { background: #ffd452; color: #222; border: none; border-radius: 8px; padding: .5rem .9rem; cursor: pointer; }
    .btn:hover { filter: brightness(1.05); }
  </style>
</head>
<body>
  <main class="wrap">
    <h1>èŸ‘è‚åœ–é‘‘</h1>
    <p>å‡ºå ´è§’è‰²èˆ‡æ“Šæ®ºçå‹µèªªæ˜ï¼š</p>

    <section class="grid" id="bugGrid" aria-label="èŸ‘è‚åœ–é‘‘å¡ç‰‡åˆ—è¡¨"></section>

    <div class="btnbar">
      <button class="btn" onclick="location.href='level_intro_01.html'">å‰å¾€ç¬¬ 1 é—œ</button>
    </div>
    <!-- æ’­éŸ³ç”¨ audio -->
    <audio id="voicePlayer" src="" hidden></audio>
  </main>
  <audio id="bgm" src="assets/sounds/cockroach_intro.mp3" loop preload="auto"></audio>

      <!-- åœ¨ BGM ä¹‹å¾Œåˆå§‹åŒ–/ç™»è¨˜ -->
  <script>
    // 1) åˆå§‹åŒ–ï¼ˆå¯æ—©å°±å‘¼å«ï¼Œå¤šæ¬¡ä¹Ÿæ²’äº‹ï¼‰
    AudioFX.init();

    // 2) ç™»è¨˜è¦è§£é–/æ’­æ”¾çš„ BGMï¼ˆä¸€å®šè¦åœ¨ <audio> ä¹‹å¾Œï¼‰
    const bgm = document.getElementById('bgm');
    AudioFX.register(bgm);

    // ï¼ˆå¯é¸ï¼‰ç•¶ä½ åˆ‡åˆ°ç„¦é»æ¨¡å¼ã€æˆ–æƒæéµæœ‰è¢«è§¸ç™¼æ™‚ï¼Œä¿éšªå«é†’ä¸€æ¬¡
    window.addEventListener('game-ready', () => { try { AudioFX.ensure(); } catch(_) {} });
  </script>

  <!-- å…ˆè¼‰å…¥è³‡æ–™ -->
  <script src="js/content/bugs.js"></script>
  <script>
    (function () {
      const bgm = document.getElementById('bgm');
      function tryPlay() {
        bgm?.play().catch(()=>{ /* ä½¿ç”¨è€…é‚„æ²’äº’å‹•å°±ç®—äº† */ });
        document.removeEventListener('click', tryPlay);
        document.removeEventListener('keydown', tryPlay);
        document.removeEventListener('touchstart', tryPlay);
      }
      document.addEventListener('click', tryPlay, { once: true });
      document.addEventListener('keydown', tryPlay, { once: true });
      document.addEventListener('touchstart', tryPlay, { once: true, passive: true });
    })();
  </script>
<script>
  // çµ±ä¸€çš„éµâ†’ä¸­æ–‡å°ç…§
  const LABELS = {
    fire: "å™´ç«æ§",
    spray: "é¦™æ°›å™´éœ§",
    slipper: "è—ç™½æ‹–",
    flamethrower: "ç«ç„°å™´å°„å™¨",
    bait: "æ¯’é¤Œ",
    vote: "è¢«ç½·å…",
    puzzle_lose: "æ¯”çŒœè¬è¼¸æ‰",
    cat: "è²“"
  };

  // æŠŠ reward è½‰ä¸­æ–‡
  function dropText(b) {
    const r = b.reward || {};
    const parts = [];
    if (r.hp)    parts.push(`ğŸ©¸ è¡€é‡ +${r.hp}`);
    if (r.coins) parts.push(`ğŸª™ é‡‘å¹£ +${r.coins}`);
    const possible = ["fire","spray","slipper","flamethrower","bait","poison_box","vote","cat"];
    possible.forEach(k => { if (r[k]) parts.push(`${LABELS[k] || k} +${r[k]}`); });
    return parts.length ? parts.join("ã€") : "â€”";
  }

  // è¢«å’¬å¾Œæœ
  function damageText(b) {
    const d = b.damage || {};
    const parts = [];
    if (d.hp)    parts.push(`ğŸ©¸ è¡€é‡ -${d.hp}`);
    if (d.coins) parts.push(`ğŸª™ é‡‘å¹£ -${d.coins}`);
    return parts.length ? parts.join("ã€") : "â€”";
  }

  // ===== æ–°å¢ï¼šç”¢ç”Ÿåœ–ç‰‡æ›¿ä»£æ–‡å­— =====
  function buildImageAlt(b) {
    // 1) è‹¥ bugs.js æä¾› imageAltï¼Œç›´æ¥ç”¨ï¼ˆæœ€æ¨è–¦ï¼‰
    if (b.imageAlt && typeof b.imageAlt === 'string') return b.imageAlt.trim();

    // 2) æ²’çµ¦å°±ç”¨ fallbackï¼šæè¿°å¤–è§€/å‹•ä½œï¼Œé¿å…é‡è¤‡åç¨±
    //   å„ªå…ˆç”¨ title/description è£¡çš„å¯è¦–å…§å®¹ï¼›éé•·å‰‡æˆªæ–·ã€‚
    const bits = [];
    // å¾æè¿°æŠ“ã€Œå¯è¦–è¦ºçš„ã€ç‰‡æ®µï¼ˆé€™è£¡å…ˆä¿å®ˆç›´æ¥å– descriptionï¼‰
    if (b.description) bits.push(b.description.replace(/\s+/g, ' ').trim());
    // è‹¥æœ‰ç¨±è™Ÿ titleï¼Œé€šå¸¸ä¹Ÿæ˜¯å¤–è§€/æ°£è³ª
    if (b.title) bits.push(b.title.replace(/\s+/g, ' ').trim());
    let alt = bits.filter(Boolean).join("ï¼Œ");
    // å¤ªçŸ­æ™‚è‡³å°‘è£œä¸€å¥ã€Œæ­£åœ¨â€¦ã€çš„å‹•æ…‹ï¼ˆå¯ä¾ä½ çš„ç´ æèª¿æ•´ï¼‰
    if (!alt) alt = "æ­£åœ¨å‡ºæ²’ä¸­çš„èŸ‘è‚ï¼Œå§¿å‹¢è©­ç¥•ã€‚";
    // æ§åˆ¶é•·åº¦è®“è®€å±æ›´é †
    if (alt.length > 120) alt = alt.slice(0, 118) + "â€¦";
    return alt;
  }

  (function renderGuide() {
    const list = (window.bugs || []);
    const grid = document.getElementById("bugGrid");
    if (!grid) return;

    grid.innerHTML = list.map(b => {
      const weaknesses = (b.weaknesses || [])
        .map(w => LABELS[w] || w)
        .map(name => `<span class="tag">${name}</span>`).join("");

      const imgAlt = buildImageAlt(b);

      return `
        <article class="card" role="article" aria-label="${b.name}">
          <img src="${b.image}" alt="${imgAlt}" loading="lazy" decoding="async">
          <h2 style="margin:.5rem 0 .25rem">${b.name}</h2>
          <div class="meta">${b.title ? `${b.title}<br>` : ""}${b.description || ""}</div>
          <div class="meta" style="margin-top:.4rem">å¼±é»ï¼š${weaknesses || "â€”"}</div>
          <div class="meta" style="margin-top:.4rem">è¢«å’¬çš„å¾Œæœï¼š${damageText(b)}</div>
          <div class="meta" style="margin-top:.4rem">æ“Šæ®ºçå‹µï¼š${dropText(b)}</div>
        </article>
      `;
    }).join("");
  })();
</script>

</body>
</html>
